environment:
  host:
    os: windows
  runtime:
    provider: appcontainer
    image: mcr.microsoft.com/dotnet/core/sdk:3.1
  
restore:
  commands:
    - !!defaultcommand
      name: 'Restore'
      command: 'build.cmd'
      arguments: '-RestoreOnly'

build:
  commands:
    - !!buildcommand
      name: 'Dotnet Build'
      command: 'build.cmd'
      logs:
        - from: 'buildlogs'
          to: 'Build Logs'
          include:
            - '**/*'
      artifacts:
        - from: 'src'
          to: 'Binaries'
          include:
            - '*/bin/Release/**/*'

package:
  commands:
    - !!buildcommand
      name: 'Dotnet Pack'
      command: 'pack.cmd'
      logs:
        - from: 'buildlogs'
          to: 'Build Logs'
          include:
            - '**/*'
      artifacts:
        - from: 'src'
          to: 'Packages'
          include:
            - '*/bin/PackageOutput/**/*.nupkg'

test:
  commands:
    - !!testcommand
      name: 'Dotnet Test'
      command: 'test.cmd'
      fail_on_stderr: false
      logs:
        - to: 'Test Logs'
          include:
            - '**/*.trx'
            - '**/*.coverage'
      testresults:
        - from: 'tests'
          title: 'Test Run'
          type: 'xunit'
          include:
            - '**/*.trx'
            - '**/*.coverage'
